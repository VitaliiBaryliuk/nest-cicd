name: 'Validate nestjs-cicd'

trigger:
  branches:
    include:
      - feat/*
    exclude:
      - main
      - develop

pr:
  autoCancel: true
  branches:
    include:
      - 'develop'
  paths:
    exclude:
      - README.md   

stages:
- stage: dev_stage_validate
  displayName: 'Run Validation Steps'
  jobs:
    - deployment: "dev_validate_job"
      pool:
        name: 'SelfHostedPool'
      environment: dev_validation
      strategy:
        runOnce:
          deploy:
            steps:
              - checkout: self

              - script: npm ci
                workingDirectory: $(System.DefaultWorkingDirectory)
                displayName: '🍳 Install Dependencies'
              - script: npm run lint
                workingDirectory: $(System.DefaultWorkingDirectory)
                displayName: '🧐 Lint'
              - script: npm run test
                workingDirectory: $(System.DefaultWorkingDirectory)
                displayName: '🧪 Test'
              - script: npm run build
                workingDirectory: $(System.DefaultWorkingDirectory)
                displayName: '🏗️ Build'